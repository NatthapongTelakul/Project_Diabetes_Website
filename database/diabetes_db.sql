-- diabetes_db.sql

CREATE DATABASE IF NOT EXISTS diabetes_db;
USE diabetes_db;

-- ตารางเก็บบัญชีผู้ใช้
CREATE TABLE Account (
    UserID INT AUTO_INCREMENT PRIMARY KEY,
    FirstName VARCHAR(100),
    LastName VARCHAR(100),
    Birthday DATE,
    Email VARCHAR(100) UNIQUE,
    Password VARCHAR(255),
    Role ENUM('User','Admin') DEFAULT 'User',
    ProfileImage VARCHAR(255) NULL,
    CreatedTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    UpdatedTime DATETIME ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO Account (UserID, FirstName, LastName, Birthday, Email, Password, Role)
VALUES
    (1, "AdminFN", "AdminLN", STR_TO_DATE('02/12/2003', '%d/%m/%Y'), "AdminEmail@gmail.com", "Admin1234", "Admin"),
    (2, "UserFN", "UserLN", STR_TO_DATE('03/12/2003', '%d/%m/%Y'), "user123@gmail.com", "$2y$10$WNmnosqqy1iqkkLYW2RBmepvdRd05pnF5LvBde3DkOsaIc7Gn/gpW", "User");

-- ตารางหมวดหมู่ความเสี่ยง
CREATE TABLE Category (
    CategoryID INT AUTO_INCREMENT PRIMARY KEY,
    RiskPercent_Lower FLOAT,
    RiskPercent_Upper FLOAT,
    Result_Text VARCHAR(255),
    Recommendation TEXT
);

INSERT INTO Category (CategoryID, RiskPercent_Lower, RiskPercent_Upper, Result_Text, Recommendation)
VALUES
    (1, 0, 49, "ความเสี่ยงต่ำที่สุด", "สีขาว(ปกติ)\n
    อาหาร: ปลูกผักกินเอง งดน้ำอัดลม รับประทานผลไม้รสไม่หวานจัด หลีกเลี่ยงหอยนางรม หมึก กุ้งตัวใหญ่ เนื้อสัตว์ติดมัน ลดการบริโภคผงชูรส รสดี ซอสปรุงรส ลดดื่มกาแฟสำเร็จรูป เครื่องดื่มชูกำลัง มาม่า ลดการเติมน้ำปลา\n
    ออกกำลังกาย: ควรออกกำลังกายอย่างสม่ำเสมอ อย่างน้อยสัปดาห์ละ 3 วัน วันละอย่างน้อย 30 นาที เช่น การเดิน การวิ่งเหยาะ ไทเก็ก ปั่นจักรยาน เป็นต้น ผู้สูงอายุควรหลีกเลี่ยงการเหวี่ยง การกระแทก การแกว่งแขน ควบคุมน้ำหนัก BMI < 25 kg/m^2 และ/หรือ รอบเอวน้อยกว่าหรือเท่ากับ 90 เซนติเมตรในผู้ชาย หรือน้อยกว่าหรือเท่ากับ 80 เซนติเมตรในผู้หญิง\n
    อารมณ์: ทำจิตใจให้แจ่มใสอยู่เสมอ หาวิธีคลายเครียด หรือทำกิจกรรมร่วมกับครอบครัว เช่น ปลูกต้นไม้ เล่นดนตรี วาดภาพ ท่องเที่ยว หรือปฏิบัติศาสนกิจ เป็นต้น รวมทั้งควรพักผ่อนให้เพียงพอ วันละ 6-8 ชั่วโมง\n
    อบายมุข: ลด/เลิกบุหรี่ และเครื่องดื่มแอลกอฮอล์\n
    การติดตาม/พบแพทย์: ตรวจสุขภาพอย่างน้อยปีละ 1 ครั้ง (ตามแนวทาง)
    "),
    (2, 50, 59, "ความเสี่ยงต่ำ", "สีเขียวเข้ม\n
    อาหาร: รับประทานข้าวไม่ขัดสี เช่นข้าวกล้อง 5-8 ทัพพี/วัน - รับประทานผักวันละ 3 ทัพพี (กรณีของผักใบเขียว รับประทานได้ไม่จำกัดจำนวน เช่น ผักกาด, คะน้า, ผักบุ้ง, ถั่วฝักยาว) - ผลไม้ (ควรหลีกเลี่ยงผลไม้ที่มีรสหวานจัด) - ถั่ว ธัญพืช วันละประมาณครึ่งถึง 1 ทัพพี - ควรหลีกเลี่ยงเนื้อสัตว์ที่ติดมัน, เครื่องในสัตว์, อาหารทะเล ยกเว้นเนื้อปลา\n
    ออกกำลังกาย: ควรออกกำลังกายอย่างสม่ำเสมอ อย่างน้อยสัปดาห์ละ 3 วัน วันละอย่างน้อย 30 นาที เช่น การเดิน การวิ่งเหยาะ ไทเก็ก ปั่นจักรยาน เป็นต้น ผู้สูงอายุควรหลีกเลี่ยงการเหวี่ยง การกระแทก การแกว่งแขน ควบคุมน้ำหนัก BMI < 25 kg/m^2 และ/หรือ รอบเอวน้อยกว่าหรือเท่ากับ 90 เซนติเมตรในผู้ชาย หรือน้อยกว่าหรือเท่ากับ 80 เซนติเมตรในผู้หญิง\n
    อารมณ์: ทำจิตใจให้แจ่มใสอยู่เสมอ หาวิธีคลายเครียด หรือทำกิจกรรมร่วมกับครอบครัว เช่น ปลูกต้นไม้ เล่นดนตรี วาดภาพ ท่องเที่ยว หรือปฏิบัติศาสนกิจ เป็นต้น รวมทั้งควรพักผ่อนให้เพียงพอ วันละ 6-8 ชั่วโมง\n
    อบายมุข: - ลดอ้วน ลดพุงให้ได้ - ลด/เลิกบุหรี่ และเครื่องดื่มแอลกอฮอล์ -รับประทานยาต่อเนื่อง - ลดการบริโภคน้ำตาลหรือเครื่องต่างๆที่มีน้ำตาลสำหรับผู้ป่วยเบาหวาน - ลดการบริโภคอาหาร มัน เค็ม สำหรับผู้ป่วยความดันโลหิตสูง\n
    การติดตาม/พบแพทย์: นัดพบแพทย์ 3 เดือน/ครั้ง
    "),
    (3, 60, 69, "ความเสี่ยงปานกลาง", "สีเหลือง\n
    อาหาร: รับประทานผัก ผลไม้ครึ่งหนึ่ง อย่างอื่นครึ่งหนึ่ง รับประทานข้าวไม่ขัดสี เช่นข้าวกล้อง 5-8 ทัพพี/วัน - รับประทานผักวันละ 3 ทัพพี (กรณีของผักใบเขียว รับประทานได้ไม่จำกัดจำนวน เช่น ผักกาด, คะน้า, ผักบุ้ง, ถั่วฝักยาว) - ผลไม้(ควรหลีกเลี่ยงผลไม้ที่มีรสหวานจัด) - ถั่ว ธัญพืช วันละประมาณครึ่งถึง 1 ทัพพี - ควรหลีกเลี่ยงเนื้อสัตว์ที่ติดมัน, เครื่องในสัตว์, อาหารทะเลยกเว้นเนื้อปลา\n
    ออกกำลังกาย: ควรออกกำลังกายอย่างสม่ำเสมอ อย่างน้อยสัปดาห์ละ 3 วัน วันละอย่างน้อย 30 นาที เช่น การเดิน การวิ่งเหยาะ ไทเก็ก ปั่นจักรยาน เป็นต้น ผู้สูงอายุควรหลีกเลี่ยงการเหวี่ยง การกระแทก การแกว่งแขน ควบคุมน้ำหนัก BMI < 25 kg/m^2  และ/หรือ รอบเอวน้อยกว่าหรือเท่ากับ 90 เซนติเมตรในผู้ชาย หรือน้อยกว่าหรือเท่ากับ 80 เซนติเมตรในผู้หญิง\n
    อารมณ์: ทำจิตใจให้แจ่มใสอยู่เสมอ หาวิธีคลายเครียด หรือทำกิจกรรมร่วมกับครอบครัว เช่น ปลูกต้นไม้ เล่นดนตรี วาดภาพ ท่องเที่ยว หรือปฏิบัติศาสนกิจ เป็นต้น รวมทั้งควรพักผ่อนให้เพียงพอ วันละ 6-8 ชั่วโมง\n
    อบายมุข: - ลดอ้วน ลดพุงให้ได้ - ลด/เลิกบุหรี่ และเครื่องดื่มแอลกอฮอลล์\n
    การติดตาม/พบแพทย์: นัดพบแพทย์ 1 เดือน/ครั้ง
    "),
    (4, 70, 89, "ความเสี่ยงมาก", "สีส้ม\n
    อาหาร: รับประทานข้าวไม่ขัดสี เช่นข้าวกล้อง 5-8 ทัพพี/มื้อ - รับประทานผักวันละ 3 ทัพพี (กรณีของผักใบเขียว รับประทานได้ไม่จำกัดจำนวน เช่น ผักกาด, คะน้า, ผักบุ้ง, ถั่วฝักยาว) - รับประทานผลไม้ไม่เกิน 2-3 ส่วน (จำกัดจำนวน)/วัน - ดื่มนมจืดพร่องมันเนยวันละ 3 แก้วและหลีกเลี่ยงเครื่องดื่มที่มีน้ำตาล - ควรหลีกเลี่ยงเนื้อสัตว์ที่ติดมัน, เครื่องในสัตว์, อาหารทะเลยกเว้นเนื้อปลา\n
    ออกกำลังกาย: ควรออกกำลังกายอย่างสม่ำเสมอ อย่างน้อยสัปดาห์ละ 3 วัน วันละอย่างน้อย 30 นาที เช่น การเดิน การวิ่งเหยาะ ไทเก็ก ปั่นจักรยาน เป็นต้น ผู้สูงอายุควรหลีกเลี่ยงการเหวี่ยง การกระแทก การแกว่งแขน ควบคุมน้ำหนัก BMI < 25 kg/m^2 และ/หรือ รอบเอวน้อยกว่าหรือเท่ากับ 90 เซนติเมตรในผู้ชาย หรือน้อยกว่าหรือเท่ากับ 80 เซนติเมตรในผู้หญิง\n
    อารมณ์: ทำจิตใจให้แจ่มใสอยู่เสมอ หาวิธีคลายเครียด หรือทำกิจกรรมร่วมกับครอบครัว เช่น ปลูกต้นไม้ เล่นดนตรี วาดภาพ ท่องเที่ยว หรือปฏิบัติศาสนกิจ เป็นต้น รวมทั้งควรพักผ่อนให้เพียงพอ วันละ 6-8 ชั่วโมง\n
    อบายมุข: - ลดอ้วน ลดพุงให้ได้ - ลด/เลิกบุหรี่ และเครื่องดื่มแอลกอฮอลล์ - วัดความดันทุกเดือน ตรวจวัดระดับน้ำตาลทุก 1-3 เดือน - ลดการบริโภคน้ำตาลหรือเครื่องต่างๆที่มีน้ำตาลสำหรับผู้ป่วยเบาหวาน - ลดการบริโภคอาหาร มัน เค็ม สำหรับผู้ป่วยความดันโลหิตสูง - ตรวจภาวะแทรกซ้อน ตา เท้าในผู้ป่วยเบาหวานและไต หัวใจ สมองอย่างน้อยปีละ 1 ครั้งในผู้ป่วยเบาหวานและความดันโลหิตสูง\n
    การติดตาม/พบแพทย์: พบแพทย์ตามนัดทุก 1 เดือน หรือเมื่อมีอาการผิดปกติและติดตามเยี่ยมบ้าน
    "),
    (5, 90, 100, "ความเสี่ยงมากที่สุด", "สีแดง\n
    อาหาร: รับประทานผัก ผลไม้ครึ่งหนึ่ง อย่างอื่นครึ่งหนึ่ง รับประทานข้าวไม่ขัดสี เช่นข้าวกล้อง 5-8 ทัพพี - ผักวันละ 3 ทัพพี (กรณีของผักใบเขียว รับประทานได้ไม่จำกัดจำนวน เช่น ผักกาด, คะน้า, ผักบุ้ง, ถั่วฝักยาว) - รับประทานผลไม้ไม่เกิน 2-3 ส่วน (จำกัดจำนวน)/วัน - ดื่มนมจืดพร่องมันเนยวันละ 1 แก้วและหลีกเลี่ยงเครื่องดื่มที่มีน้ำตาล - ควรหลีกเลี่ยงเนื้อสัตว์ที่ติดมัน,เครื่องในสัตว์,อาหารทะเลยกเว้นเนื้อปลา\n
    ออกกำลังกาย: ควรออกกำลังกายอย่างสม่ำเสมอ อย่างน้อยสัปดาห์ละ 3 วัน วันละอย่างน้อย 30 นาที เช่น การเดิน การวิ่งเหยาะ ไทเก็ก ปั่นจักรยาน เป็นต้น ผู้สูงอายุควรหลีกเลี่ยงการเหวี่ยง การกระแทก การแกว่งแขน\n ควบคุมน้ำหนัก BMI < 25 kg/m^2 และ/หรือ รอบเอวน้อยกว่าหรือเท่ากับ 90 เซนติเมตรในผู้ชาย หรือน้อยกว่าหรือเท่ากับ 80 เซนติเมตรในผู้หญิง\n
    อารมณ์: ทำจิตใจให้แจ่มใสอยู่เสมอ หาวิธีคลายเครียด หรือทำกิจกรรมร่วมกับครอบครัว เช่น ปลูกต้นไม้ เล่นดนตรี วาดภาพ ท่องเที่ยว หรือปฏิบัติศาสนกิจ เป็นต้น รวมทั้งควรพักผ่อนให้เพียงพอ วันละ 6-8 ชั่วโมง\n
    อบายมุข: - ลดอ้วน ลดพุงให้ได้ - ลด/เลิกบุหรี่ และเครื่องดื่มแอลกอฮอลล์ - วัดความดันทุกเดือน ตรวจวัดระดับน้ำตาลทุก 1-3 เดือน - ลดการบริโภคน้ำตาลหรือเครื่องต่างๆที่มีน้ำตาลสำหรับผู้ป่วยเบาหวาน - ลดการบริโภคอาหาร มัน เค็ม สำหรับผู้ป่วยความดันโลหิตสูง - ตรวจภาวะแทรกซ้อน ตา เท้าในผู้ป่วยเบาหวานและไต หัวใจ สมองอย่างน้อยปีละ 1 ครั้งในผู้ป่วยเบาหวานและความดันโลหิตสูง\n
    การติดตาม/พบแพทย์: พบแพทย์ตามนัดทุก 2- 4 สัปดาห์หรือเมื่อมีอาการผิดปกติและได้รับการโทร/ติดตามเยี่ยมบ้าน
    ");

-- ตารางเก็บผลประเมิน
CREATE TABLE PredictionRecord (
    PredictionID INT AUTO_INCREMENT PRIMARY KEY,
    UserID INT,
    HighBP INT,
    HighChol INT,
    BMI INT,
    HeartDiseaseorAttack INT,
    GenHlth INT,
    PhysHlth INT,
    DiffWalk INT,
    Age INT,
    BMI_cat_code INT,
    BMI_Age_interaction INT,
    CategoryID INT,
    Height INT,
    Weight INT,
    Model_Used VARCHAR(100),
    PredictDateTime DATETIME,
    Result_Binary INT,
    Result_Percentage FLOAT,
    UserNote TEXT,
    FOREIGN KEY (UserID) REFERENCES Account(UserID),
    FOREIGN KEY (CategoryID) REFERENCES Category(CategoryID)
);

-- ตารางบันทึกการกระทำของแอดมิน
CREATE TABLE AdminLog (
    LogID INT AUTO_INCREMENT PRIMARY KEY,
    UserID INT,
    Action VARCHAR(255),
    TargetType ENUM('Image','Model','Recommendation'),
    TargetID INT NULL,
    Timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (UserID) REFERENCES Account(UserID)
);

-- ตารางรูปภาพความรู้
CREATE TABLE HealthImage (
    ImageID INT AUTO_INCREMENT PRIMARY KEY,
    Title VARCHAR(255),
    Description TEXT,
    ImagePath VARCHAR(255),
    UploadedBy INT,
    UploadedTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (UploadedBy) REFERENCES Account(UserID)
);

-- ตารางเก็บไฟล์โมเดล
CREATE TABLE ModelFile (
    ModelID INT AUTO_INCREMENT PRIMARY KEY,
    FileName VARCHAR(255),
    FilePath VARCHAR(255),
    UploadedBy INT,
    UploadedTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    Status ENUM('Active','Deprecated') DEFAULT 'Active',
    FOREIGN KEY (UploadedBy) REFERENCES Account(UserID)
);
