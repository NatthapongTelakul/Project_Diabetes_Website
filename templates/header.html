<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes assessment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style-header.css') }}">
</head>
<body>
    <header>
        <div class="logo">
        <h1>
            SugarFree
            <span class="subtitle">AI Diabetes Screening</span>
        </h1>
        </div>

        <!-- ข้อความ Welcome, ชื่อ User (ดึงชื่อจาก session) -->
        <div class="welcome" id="welcome">Welcome, {{ session.get('first_name', 'Guest') }}</div>

        <!-- Navigation bar: ปุ่มจะพาไปไฟล์ .html ของแต่ละหน้า -->
        <nav class="tabbar" id="tabbar">
        <span class="tab-notch" aria-hidden="true"></span>
        <span class="tab-indicator" aria-hidden="true"></span>
        
        <!-- เช็คว่าหน้าไหน active แล้วใส่ class is-active ให้อัตโนมัติ -->
        <button class="tab {% if current_page == 'home' %}is-active{% endif %}" 
                data-tab="home" aria-label="Home" onclick="location.href='{{ url_for('home') }}'">
            <i class="fa fa-home" aria-hidden="true"></i>
        </button>
        <button class="tab {% if current_page == 'calendar' %}is-active{% endif %}" 
                data-tab="calendar" aria-label="Calendar" onclick="location.href='{{ url_for('calendar') }}'">
            <i class="fa fa-calendar" aria-hidden="true"></i>
        </button>
        <button class="tab {% if current_page == 'profile' %}is-active{% endif %}" 
                data-tab="profile" aria-label="Profile" onclick="location.href='{{ url_for('profile') }}'">
            <i class="fa fa-user" aria-hidden="true"></i>
        </button>
        <a href="{{ url_for('menu') }}" class="tab {% if current_page == 'menu' %}is-active{% endif %}" aria-label="Menu">
            <i class="fa fa-bars" aria-hidden="true"></i>
        </a>
        </nav>
    </header>
    <main>
        {% block content %}
        <!-- Content will be injected here -->
        {% endblock %}
    </main>

    <script>
      // ฟังก์ชันอัปเดตตำแหน่ง indicator และ notch
      function updateTabIndicator(immediate = false) {
        const tabbar = document.getElementById('tabbar');
        const activeTab = tabbar.querySelector('.tab.is-active');
        const indicator = tabbar.querySelector('.tab-indicator');
        const notch = tabbar.querySelector('.tab-notch');
        
        if (activeTab && indicator && notch) {
          const tabRect = activeTab.getBoundingClientRect();
          const tabbarRect = tabbar.getBoundingClientRect();
          const offsetLeft = tabRect.left - tabbarRect.left;
          
          const centerOffset = offsetLeft + (tabRect.width / 2) - (78 / 2);
          const notchCenterOffset = offsetLeft + (tabRect.width / 2) - (105 / 2);
          
          // ถ้าต้องการให้เคลื่อนที่ทันที (ไม่มี transition)
          if (immediate) {
            indicator.style.transition = 'none';
            notch.style.transition = 'none';
          }
          
          indicator.style.transform = `translateX(${centerOffset}px)`;
          notch.style.transform = `translateX(${notchCenterOffset}px)`;
          
          // เปิด transition กลับมาหลังจาก set ตำแหน่งแล้ว
          if (immediate) {
            setTimeout(() => {
              indicator.style.transition = '';
              notch.style.transition = '';
            }, 50);
          }
        }
      }

      // ตั้งค่าตำแหน่งเริ่มต้นทันทีก่อนหน้าจอโหลดเสร็จ
      updateTabIndicator(true);

      // เรียกใช้อีกครั้งเมื่อโหลดหน้าเว็บเสร็จสมบูรณ์
      window.addEventListener('load', () => {
        updateTabIndicator(true);
      });

      // อัปเดตตำแหน่งเมื่อ resize หน้าจอ
      window.addEventListener('resize', () => updateTabIndicator(false));
    </script>
</body>
</html>